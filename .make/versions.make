# Copyright Â© 2017 The Things Network Foundation, distributed under the MIT license (see LICENSE file)

pkg/version/ttn.go: .FORCE
	@echo "// Code generated by Makefile. DO NOT EDIT." > pkg/version/ttn.go
	@echo "" >> pkg/version/ttn.go
	@echo "package version" >> pkg/version/ttn.go
	@echo "" >> pkg/version/ttn.go
	@echo "// TTN Version" >> pkg/version/ttn.go
	@echo "const TTN = \"v$(VERSION)-dev\"" >> pkg/version/ttn.go

version.bump.major: BUMP=major
version.bump.major: version.bump

version.bump.minor: BUMP=minor
version.bump.minor: version.bump

version.bump.patch: BUMP=patch
version.bump.patch: version.bump

version.bump.rc: BUMP=rc
version.bump.rc: version.bump

version.bump: VERSION=$(shell $(GO) run .make/bump.go "$(GIT_TAG)" "$(BUMP)")
version.bump: pkg/version/ttn.go
	@if [[ ! -z "`git status -s | grep -v 'pkg/version/ttn.go'`" ]]; then \
		$(err) "Working tree not clean"; \
		exit 1; \
	fi
	git add pkg/version/ttn.go
	git commit -m "all: Bump version to $(VERSION)"
	git tag -a -s -f -m "Version $(VERSION)" "v$(VERSION)"
	@$(log) "Bumped to v$(VERSION)"
